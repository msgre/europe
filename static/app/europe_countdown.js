// Generated by CoffeeScript 1.10.0
App.module("Countdown", function(Mod, App, Backbone, Marionette, $, _) {
  var Countdown, CountdownItemView, ScreenLayout, _options, handler, layout, model;
  Mod.startWithParent = false;
  _options = void 0;
  model = void 0;
  layout = void 0;
  Countdown = Backbone.Model.extend({
    defaults: {
      number: 4
    }
  });
  CountdownItemView = Marionette.ItemView.extend({
    template: function(serialized_model) {
      return _.template("<%= display_number() %>")(serialized_model);
    },
    templateHelpers: function() {
      return {
        display_number: function() {
          if (this.number === 4) {
            return 'PÅ™iprav se!';
          } else if (this.number > 0) {
            return this.number;
          } else {
            return 'Start!';
          }
        }
      };
    },
    initialize: function(options) {
      return this.model.on('change', (function(_this) {
        return function() {
          var number;
          number = _this.model.get('number');
          if (number > 0) {
            window.channel.trigger('countdown:flash');
          } else if (number === 0) {
            window.channel.trigger('countdown:noise');
          }
          return _this.render();
        };
      })(this));
    },
    onDestroy: function() {
      return this.model.off('change');
    }
  });
  ScreenLayout = Marionette.LayoutView.extend({
    template: _.template("<div id=\"body\">\n    <table class=\"countdown state-4\">\n        <tr>\n            <td></td>\n        </tr>\n    </table>\n</div>"),
    initialize: function(options) {
      this.model = options.model;
      return this.model.on('change', (function(_this) {
        return function() {
          return _this.$el.find('.countdown').attr('class', "countdown state-" + (_this.model.get('number')));
        };
      })(this));
    },
    onDestroy: function() {
      return this.model.off('change');
    },
    onRender: function() {
      return $('body').attr('class', 'layout-c');
    },
    regions: {
      cell: '.countdown td'
    }
  });
  handler = function() {
    var number;
    number = model.get('number');
    model.set('number', number - 1);
    if (number === 0) {
      clear_timer();
      window.channel.trigger('countdown:blank');
      return window.channel.trigger('countdown:close', _options);
    } else {
      return window.sfx["odpocet" + number].play();
    }
  };
  Mod.onStart = function(options) {
    console.log('Countdown module');
    console.log(options);
    _options = options;
    model = new Countdown();
    layout = new ScreenLayout({
      el: make_content_wrapper(),
      model: model
    });
    layout.render();
    layout.getRegion('cell').show(new CountdownItemView({
      model: model
    }));
    return set_timer(handler, _options.options.COUNTDOWN_TICK_TIMEOUT);
  };
  return Mod.onStop = function() {
    clear_timer();
    layout.destroy();
    return model = void 0;
  };
});
